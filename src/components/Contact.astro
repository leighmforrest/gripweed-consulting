---
import Section from "./Section.astro";
---

<Section sectionId="contact">
  <div class="grid grid-cols-1 md:grid-cols-2 min-h-screen gap-4 p-4">
    <!-- Left Side -->
    <div class="flex flex-col p-4 h-full">
      <h2
        class="text-4xl text-vermillion dark:text-dark-vermillion text-center"
      >
        Get In Touch
      </h2>
      <p class="mt-4 text-center">
        Lorem ipsum dolor sit amet consectetur adipisicing elit...
      </p>
    </div>

    <!-- Form -->
    <form
      class="flex flex-col rounded-xl shadow-md border border-gray-400 dark:border-gray-500 p-4 h-full"
    >
      <h2
        class="text-4xl text-vermillion dark:text-dark-vermillion text-center"
      >
        Contact Us
      </h2>
      <!-- Honeypot field -->
      <div class="hidden">
        <label for="website">Website</label>
        <input type="text" name="website" autocomplete="off" />
      </div>

      <!-- Full Name -->
      <div class="flex flex-col mt-4">
        <label
          for="fullName"
          class="block mb-2 text-md font-medium text-gray-900 dark:text-gray-400"
          >Full Name</label
        >
        <input
          type="text"
          name="fullName"
          placeholder="Full Name"
          class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-vermillion"
        />
        <p class="text-red-500 text-sm mt-1 hidden error-message"></p>
      </div>

      <!-- Email -->
      <div class="flex flex-col mt-4">
        <label
          for="emailAddress"
          class="block mb-2 text-md font-medium text-gray-900 dark:text-gray-400"
          >Email Address</label
        >
        <input
          type="text"
          name="emailAddress"
          placeholder="Email Address"
          class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-vermillion"
        />
        <p class="text-red-500 text-sm mt-1 hidden error-message"></p>
      </div>

      <!-- Message -->
      <div class="flex flex-col mt-4">
        <label
          for="message"
          class="block mb-2 text-md font-medium text-gray-900 dark:text-gray-400"
          >Your message</label
        >
        <textarea
          name="message"
          rows="6"
          placeholder="Your message..."
          class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-vermillion resize-none"
        ></textarea>
        <p class="text-red-500 text-sm mt-1 hidden error-message"></p>
      </div>

      <div class="flex justify-end mt-4">
        <button
          id="submitContact"
          type="submit"
          class="px-6 py-3 bg-vermillion text-white font-medium rounded-lg shadow hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-vermillion"
        >
          Send
        </button>
      </div>
    </form>
  </div>
</Section>

<script>
  import { showError, clearError } from "../scripts/formErrors.js";

  document.addEventListener("DOMContentLoaded", () => {
    const contactForm = document.querySelector("form");
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    const fields = {
      fullName: { length: { min: 5, max: 50 } },
      emailAddress: {
        length: { min: 5, max: 50 },
        pattern: {
          regex: emailRegex,
          message: "Please enter a valid email address.",
        },
      },
      message: { length: { min: 5, max: 500 } },
    };

    const validateField = (field, formValues) => {
      const input = contactForm.querySelector(`[name="${field}"]`);
      const value = formValues[field]?.toString().trim();
      clearError(input);

      if (!value) {
        showError(input, "This field is required.");
        return false;
      }

      const { min, max } = fields[field].length;
      if (value.length < min || value.length > max) {
        showError(input, `Must be between ${min} and ${max} characters.`);
        return false;
      }

      if (fields[field].pattern) {
        const { regex, message } = fields[field].pattern;
        if (!regex.test(value)) {
          showError(input, message);
          return false;
        }
      }

      // Success: green border
      input.classList.add(
        "border-2",
        "border-green-500",
        "!focus:border-green-500"
      );
      return true;
    };

    Object.keys(fields).forEach((field) => {
      const input = contactForm.querySelector(`[name="${field}"]`);
      if (!input) return;

      input.addEventListener("blur", () => {
        const formValues = Object.fromEntries(
          new FormData(contactForm).entries()
        );
        validateField(field, formValues);
      });
    });

    contactForm.addEventListener("submit", (event) => {
      event.preventDefault();
      const formValues = Object.fromEntries(
        new FormData(contactForm).entries()
      );
      let isValid = true;

      if (formValues.website) {
        console.warn("Bot detected! Submission blocked.");
        return; // stop processing
      }

      Object.keys(fields).forEach((field) => {
        if (!validateField(field, formValues)) isValid = false;
      });

      if (!isValid) return;

      console.log("Form is valid:", formValues);
      // TODO: submit to server
    });
  });
</script>
